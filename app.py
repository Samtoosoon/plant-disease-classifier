import streamlit as st
import tensorflow as tf
import numpy as np
from PIL import Image
import requests  # Added for downloading model

def download_model(url):
    response = requests.get(url, allow_redirects=True)
    if response.status_code == 200:
        with open("plant_disease_model.keras", "wb") as f:
            f.write(response.content)
        return "Model downloaded successfully!"
    else:
        return f"Error downloading model: {response.status_code}"

# Download model from Google Drive (replace with your actual link)
model_download_message = download_model("https://drive.google.com/file/d/1-3ruHJ25v1o3_UWQOGFOGArYuxeg6wye/view?usp=sharing")
st.info(model_download_message)  # Display download status

@st.cache_resource
def load_model():
    model = tf.keras.models.load_model('https://drive.google.com/file/d/1-3ruHJ25v1o3_UWQOGFOGArYuxeg6wye/view?usp=sharing')
    return model

def preprocess_image(image):
    img = image.resize((256, 256))
    img_array = np.array(img) / 255.0
    img_array = np.expand_dims(img_array, axis=0)
    return img_array

def main():
    st.title('Plant Disease Classification (Potato)')

    # Display the provided default potato image
    default_image_url = "data:image/jpeg;base64,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ERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERAREQEREBERB//Z"
    st.image(default_image_url, caption='Example Leaf Image', use_column_width=True)

    uploaded_file = st.file_uploader("Choose a potato leaf image", type=["jpg", "jpeg", "png"])

    if uploaded_file is not None:
        image = Image.open(uploaded_file)
        st.image(image, caption='Uploaded 1  Image', use_column_width=True)

        model = load_model()
        processed_image = preprocess_image(image)

        prediction = model.predict(processed_image)
        predicted_class = np.argmax(prediction)
        confidence = round(100 * np.max(prediction), 2)

        class_names = ['Healthy', 'Lateblight', 'Earlyblight']

        st.subheader('Prediction Results')
        st.write(f'Predicted Class: {class_names[predicted_class]}')
        st.write(f'Confidence: {confidence}%')

if __name__ == '__main__':
    main()
